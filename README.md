# 🚀 업비트 모멘텀 트레이딩 봇

"달리는 말에 올라타는" 전략을 구현한 자동 코인 트레이딩 봇입니다.

## 📋 전략 개요

### 핵심 철학
- **거시적 분석**: 일/주/월 캔들로 전체 시장 추세 파악 (하락장 관망)
- **미시적 분석**: 분봉 + **초봉**으로 실시간 모멘텀 감지
- **빠른 진입**: 상승 모멘텀 감지 시 시장가로 즉시 매수
- **동적 청산**: 트레일링 스탑으로 수익 보호, 빠른 손절로 손실 최소화

### 다중 시간대 분석 (Multi-Timeframe Analysis) - 단타 전문가 기법

```
┌─────────────────────────────────────────────────────────────┐
│  추세 분석 (5분마다 업데이트)                                  │
│  ├── 15분봉 (40%): 최근 15분 수급 흐름 (초단기 대응)         │
│  ├── 30분봉 (25%): 중단기 지지/저항 확인                     │
│  ├── 1시간/4시간 (30%): 매물대 및 추세 배경                   │
│  └── 일봉 (5%): 현재 위치 확인                               │
│       → � 단기 수급 폭발(15분 > 0.5%) 시 거시 하락장 무시   │
├─────────────────────────────────────────────────────────────┤
│  미시 분석 (1초마다 업데이트)                                  │
│  ├── 가격 가속도(Velocity): 분당 0.1% 이상의 빠른 돌파 감지  │
│  ├── 수급 집중도(Intensity): 평균 대비 2배 이상의 거래량 집중│
│  └── 초봉(1초): 최적의 진입 포인트 타격                       │
└─────────────────────────────────────────────────────────────┘
```

### 진입 조건
1. 거시 추세가 **하락장이 아닐 것** (bearish가 아니면 거래 가능)
2. 분봉 모멘텀: 최근 10분간 **+0.3% 이상** 상승
3. 거래량 급등: 평균 대비 **1.5배 이상** 또는 연속 상승 캔들 3개
4. 초봉 확인: 급등 감지 시 **빠른 진입** 기회 제공

### 청산 전략 (트레일링 스탑)

```
매수 후
    │
    ├── +0.3% 도달 → 트레일링 스탑 활성화 (손절선 상향 시작)
    │
    ├── +1.0% 도달 → 손절선을 매입가로 올림 (손실 없이 청산 보장!)
    │                    ↓
    │              계속 상승 추세 추적 (바로 익절하지 않음)
    │                    ↓
    └── 고점에서 -0.4% 하락 → 트레일링 스탑 발동 (익절)

손절: 매입가 대비 -0.5% 도달 시 즉시 매도
시간제한: 30분 보유 시 자동 청산
```

## 🛠 설치 및 실행

### 1. 환경 설정
```bash
# 가상환경 생성
python3 -m venv venv

# 가상환경 활성화
source venv/bin/activate

# 패키지 설치
pip install websockets aiohttp python-dotenv PyJWT requests
```

### 2. API 키 설정
`.env` 파일에 업비트 API 키가 설정되어 있어야 합니다:
```
UPBIT_ACCESS_KEY=your_access_key
UPBIT_SECRET_KEY=your_secret_key
```

### 3. 실행
```bash
# 방법 1: 직접 실행
./venv/bin/python momentum_trader.py

# 방법 2: 백그라운드 실행
nohup ./venv/bin/python momentum_trader.py > trading.log 2>&1 &

# 로그 실시간 확인
tail -f trading.log
```

## ⚙️ 파라미터 조정

`momentum_trader.py` 상단의 파라미터를 조정하여 전략을 커스터마이징할 수 있습니다:

### 투자 설정
| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `MAX_INVESTMENT` | 1,000,000 | 최대 투자금 (원) |
| `MIN_ORDER_AMOUNT` | 5,100 | 최소 주문 금액 |
| `TRADING_FEE_RATE` | 0.0005 | 거래 수수료 (0.05%) |

### 1. 추세 분석 (Macro/Trend Analysis)
전체적인 시장의 분위기를 파악하여 거래 가능 여부를 결정합니다.

| 파라미터 | 기본값 | 상세 설명 |
|---------|--------|----------|
| `MACRO_LOOKBACK_DAYS` | 7 | 일봉 분석 시 참고할 과거 기간입니다. |
| `MACRO_MIN_CHANGE_RATE` | -0.02 | **하락장 컷오프**: 종합 점수가 -2% 이하일 경우 하락장으로 판단하고 관망합니다. |
| `MACRO_BULLISH_THRESHOLD` | 0.01 | **상승장 기준**: 종합 점수가 +1% 이상일 경우 적극적 매수 구간으로 판단합니다. |
| `MACRO_UPDATE_INTERVAL` | 300 | 추세 분석 업데이트 주기(5분)입니다. |

### 2. 단타 전문가 기법 (Pro Scalping)
거시 지표가 좋지 않아도 단기적인 수급이 폭발하는 구간을 포착합니다.

| 파라미터 | 기본값 | 상세 설명 |
|---------|--------|----------|
| `SHORT_TREND_WINDOW` | 15 | **초단기 윈도우**: 최근 15분간의 흐름을 집중 분석합니다. |
| `SHORT_MOMENTUM_THRESHOLD` | 0.005 | **단기 수급 폭발(0.5%)**: 15분 내 0.5% 반등 시 거시 지표를 무시하고 거래를 허용합니다. |
| `VOL_INTENSITY_THRESHOLD` | 2.0 | **수급 집중도**: 최근 거래량이 이전 평균 대비 2배 이상일 때 진입 강도를 높입니다. |
| `BREAKOUT_VELOCITY` | 0.001 | **가격 가속도**: 분당 0.1% 이상의 속도로 가격이 치솟을 때 돌파 매매 신호로 간주합니다. |

### 3. 진입 모멘텀 (Entry Momentum)
분봉과 초봉을 결합하여 최적의 진입 시점을 결정합니다.

| 파라미터 | 기본값 | 상세 설명 |
|---------|--------|----------|
| `MOMENTUM_THRESHOLD` | 0.003 | **분봉 기준(0.3%)**: 최근 10분간 가격이 0.3% 이상 상승해야 합니다. |
| `VOLUME_SPIKE_RATIO` | 1.5 | **거래량 배율**: 최근 거래량이 10분 평균 대비 1.5배 이상이어야 합니다. |
| `SECOND_MOMENTUM_THRESHOLD` | 0.001 | **초봉 기준(0.1%)**: 최근 12초간 가격이 0.1% 이상 상승해야 합니다. |
| `SECOND_RAPID_RISE_THRESHOLD` | 0.002 | **급등 감지(0.2%)**: 5초 내에 0.2% 이상 급등 시 '빠른 진입'을 시도합니다. |

### 4. 청산 및 리스크 관리 (Exit & Risk)
수익을 지키고 손실을 최소화하는 핵심 설정입니다.

| 파라미터 | 기본값 | 상세 설명 |
|---------|--------|----------|
| `INITIAL_STOP_LOSS` | 0.005 | **손절선(-0.5%)**: 매입가 대비 0.5% 하락 시 즉시 시장가 매도합니다. |
| `TRAILING_STOP_ACTIVATION` | 0.003 | **익절 준비(+0.3%)**: 수익률이 0.3%를 넘어서면 추적 수익 보존 모드로 들어갑니다. |
| `TAKE_PROFIT_TARGET` | 0.01 | **목표 수익률(1%)**: 1% 도달 시 손절선을 매입가로 상향하여 원금을 보장하고 추가 상승을 노립니다. |
| `TRAILING_STOP_DISTANCE` | 0.004 | **추적 거리(0.4%)**: 고점 대비 0.4% 하락 시 추세가 꺾인 것으로 보고 익절합니다. |
| `MAX_HOLDING_TIME` | 1800 | **시간 제한(30분)**: 30분 동안 목표에 도달하지 못하면 기회비용 확보를 위해 청산합니다. |
| `COOL_DOWN_AFTER_LOSS` | 180 | **뇌동매매 방지**: 손절 발생 후 3분간은 추가 진입을 금지합니다. |

### 5. 시스템 및 기타 설정
| 파라미터 | 기본값 | 상세 설명 |
|---------|--------|----------|
| `MARKET` | KRW-BTC | 거래 대상 코인입니다. |
| `DRY_RUN` | True | **실제 거래 여부**: True면 주문을 내지 않는 테스트 모드입니다. |
| `MAX_TRADES_PER_HOUR` | 10 | 과도한 거래 방지를 위한 시간당 최대 거래 횟수 제한입니다. |

## 📊 로그 해석

```
# 시작 시 표시
🚀 모멘텀 트레이딩 봇 시작
💰 KRW 잔고: 9,982,472원
📈 추세 분석 | bullish (점수:0.0251) | 1h:+1.20% 4h:+0.45% 일:+2.72% | 🚀 단기 급반등 감지됨
📡 WebSocket 연결됨 - 실시간 가격 모니터링 시작

# 30초마다 분석 상태 표시
📊 현재가: 137,370,000원 | 분봉:20개 초봉:24개 | 강도: 15.3

# 진입 신호 감지 시
🎯 진입 신호 감지! | 분봉모멘텀 0.35% / 거래량 2.1배 | 강도: 65.0
🚀 진입 신호 감지! | ⚡빠른진입: 🚀급등 0.25% | 강도: 72.0  (초봉 급등)

# 매수 체결
🛒 시장가 매수 주문 | UUID: xxx | 금액: 1,000,000원
✅ 매수 체결 | 가격: 137,370,000원 | 손절가: 136,683,000원

# 트레일링 스탑 활성화
📊 트레일링 스탑 활성화 | 수익률: 0.32%
🎯 목표 수익률 1.0% 도달! 트레일링 활성화 (손절가→매입가: 137,370,000원)

# 보유 중 상태
📈 보유 중 | 현재가: 138,000,000원 | 수익률: +0.46% | 손절가: 137,448,000원

# 매도 완료
🎉 매도 완료 | 사유: trailing_stop | 수익: +8,500원 (+0.85%)
```

## ⚠️ 주의사항

1. **테스트 모드**: 기본값으로 `DRY_RUN = True`가 설정되어 있어 실제 거래가 수행되지 않습니다.

2. **실제 거래 시**: `DRY_RUN = False`로 변경 후 반드시 소액으로 테스트하세요.

3. **API 제한**: 업비트 API 요청 제한:
   - 시세 조회: 초당 10회
   - 주문 생성/취소: 초당 8회

4. **수수료**: 거래 수수료 0.05%가 누적되므로 빈번한 거래 주의

5. **네트워크**: 안정적인 환경에서 실행 권장

## 📝 테스트

```bash
# 최소 금액으로 매수/매도 테스트
./venv/bin/python test_order.py
```

## 📁 파일 구조

```
upbit2/
├── momentum_trader.py   # 메인 트레이딩 봇
├── test_order.py        # 매수/매도 테스트 스크립트
├── run_trader.sh        # 실행 스크립트
├── .env                 # API 키 설정
├── api.md              # API 문서
└── README.md           # 이 파일
```

## 📝 라이선스

본 코드는 교육 및 연구 목적으로 제공됩니다.
실제 투자에 사용할 경우 발생하는 손실에 대해 책임지지 않습니다.
