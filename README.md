# 🚀 업비트 모멘텀 트레이딩 봇

"달리는 말에 올라타는" 전략을 구현한 자동 코인 트레이딩 봇입니다.

## 📋 전략 개요

### 핵심 철학
- **거시적 분석**: 일/주/월 캔들로 전체 시장 추세 파악 (하락장 관망)
- **미시적 분석**: 분봉 + **초봉**으로 실시간 모멘텀 감지
- **빠른 진입**: 상승 모멘텀 감지 시 시장가로 즉시 매수
- **동적 청산**: 트레일링 스탑으로 수익 보호, 빠른 손절로 손실 최소화

### 다중 시간대 분석 (Multi-Timeframe Analysis) - 단타 전문가 기법

```
┌─────────────────────────────────────────────────────────────┐
│  추세 분석 (5분마다 업데이트)                                  │
│  ├── 15분봉 (40%): 최근 15분 수급 흐름 (초단기 대응)         │
│  ├── 30분봉 (25%): 중단기 지지/저항 확인                     │
│  ├── 1시간/4시간 (30%): 매물대 및 추세 배경                   │
│  └── 일봉 (5%): 현재 위치 확인                               │
│       → � 단기 수급 폭발(15분 > 0.5%) 시 거시 하락장 무시   │
├─────────────────────────────────────────────────────────────┤
│  미시 분석 (1초마다 업데이트)                                  │
│  ├── 가격 가속도(Velocity): 분당 0.1% 이상의 빠른 돌파 감지  │
│  ├── 수급 집중도(Intensity): 평균 대비 2배 이상의 거래량 집중│
│  └── 초봉(1초): 최적의 진입 포인트 타격                       │
└─────────────────────────────────────────────────────────────┘
```

### 진입 조건
1. 거시 추세가 **하락장이 아닐 것** (bearish가 아니면 거래 가능)
2. 분봉 모멘텀: 최근 10분간 **+0.3% 이상** 상승
3. 거래량 급등: 평균 대비 **1.5배 이상** 또는 연속 상승 캔들 3개
4. 초봉 확인: 급등 감지 시 **빠른 진입** 기회 제공

### 청산 전략 (트레일링 스탑)

```
매수 후
    │
    ├── +0.3% 도달 → 트레일링 스탑 활성화 (손절선 상향 시작)
    │
    ├── +1.0% 도달 → 손절선을 매입가로 올림 (손실 없이 청산 보장!)
    │                    ↓
    │              계속 상승 추세 추적 (바로 익절하지 않음)
    │                    ↓
    └── 고점에서 -0.4% 하락 → 트레일링 스탑 발동 (익절)

손절: 매입가 대비 -0.5% 도달 시 즉시 매도
시간제한: 30분 보유 시 자동 청산
```

## 🛠 설치 및 실행

### 1. 환경 설정
```bash
# 가상환경 생성
python3 -m venv venv

# 가상환경 활성화
source venv/bin/activate

# 패키지 설치
pip install websockets aiohttp python-dotenv PyJWT requests
```

### 2. API 키 설정
`.env` 파일에 업비트 API 키가 설정되어 있어야 합니다:
```
UPBIT_ACCESS_KEY=your_access_key
UPBIT_SECRET_KEY=your_secret_key
```

### 3. 실행
```bash
# 방법 1: 직접 실행
./venv/bin/python momentum_trader.py

# 방법 2: 백그라운드 실행
nohup ./venv/bin/python momentum_trader.py > trading.log 2>&1 &

# 로그 실시간 확인
tail -f trading.log
```

## ⚙️ 파라미터 조정

`momentum_trader.py` 상단의 파라미터를 조정하여 전략을 커스터마이징할 수 있습니다:

### 투자 설정
| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `MAX_INVESTMENT` | 1,000,000 | 최대 투자금 (원) |
| `MIN_ORDER_AMOUNT` | 5,100 | 최소 주문 금액 |
| `TRADING_FEE_RATE` | 0.0005 | 거래 수수료 (0.05%) |

### 거시 분석 (Macro Analysis)
| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `MACRO_LOOKBACK_DAYS` | 7 | 일봉 분석 기간 |
| `MACRO_MIN_CHANGE_RATE` | -0.02 | 하락장 판단 기준 (-2%) |
| `MACRO_BULLISH_THRESHOLD` | 0.01 | 상승장 판단 기준 (+1%) |
| `MACRO_UPDATE_INTERVAL` | 300 | 거시 분석 갱신 주기 (5분) |

### 미시 분석 - 분봉 (Minute Candle)
| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `MOMENTUM_WINDOW` | 10 | 분봉 분석 윈도우 |
| `MOMENTUM_THRESHOLD` | 0.003 | 진입 모멘텀 기준 (0.3%) |
| `VOLUME_SPIKE_RATIO` | 1.5 | 거래량 급등 배율 |
| `CONSECUTIVE_UP_CANDLES` | 3 | 연속 상승 캔들 개수 |

### 미시 분석 - 초봉 (Second Candle)
| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `USE_SECOND_CANDLES` | True | 초봉 사용 여부 |
| `SECOND_MOMENTUM_WINDOW` | 12 | 초봉 분석 윈도우 |
| `SECOND_MOMENTUM_THRESHOLD` | 0.001 | 초봉 모멘텀 기준 (0.1%) |
| `SECOND_RAPID_RISE_THRESHOLD` | 0.002 | 급등 판단 기준 (0.2%) |

### 익절/손절 설정
| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `INITIAL_STOP_LOSS` | 0.005 | 초기 손절선 (**0.5%**) |
| `TRAILING_STOP_ACTIVATION` | 0.003 | 트레일링 활성화 (+0.3%) |
| `TRAILING_STOP_DISTANCE` | 0.004 | 트레일링 거리 (0.4%) |
| `TAKE_PROFIT_TARGET` | 0.01 | 목표 수익률 (**1%** - 바로 익절 안 함) |
| `MAX_HOLDING_TIME` | 1800 | 최대 보유 시간 (30분) |

### 시스템 설정
| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `MARKET` | KRW-BTC | 거래 마켓 |
| `DRY_RUN` | True | 테스트 모드 |

## 📊 로그 해석

```
# 시작 시 표시
🚀 모멘텀 트레이딩 봇 시작
💰 KRW 잔고: 9,982,472원
📈 추세 분석 | bullish (점수:0.0251) | 1h:+1.20% 4h:+0.45% 일:+2.72% | 🚀 단기 급반등 감지됨
📡 WebSocket 연결됨 - 실시간 가격 모니터링 시작

# 30초마다 분석 상태 표시
📊 현재가: 137,370,000원 | 분봉:20개 초봉:24개 | 강도: 15.3

# 진입 신호 감지 시
🎯 진입 신호 감지! | 분봉모멘텀 0.35% / 거래량 2.1배 | 강도: 65.0
🚀 진입 신호 감지! | ⚡빠른진입: 🚀급등 0.25% | 강도: 72.0  (초봉 급등)

# 매수 체결
🛒 시장가 매수 주문 | UUID: xxx | 금액: 1,000,000원
✅ 매수 체결 | 가격: 137,370,000원 | 손절가: 136,683,000원

# 트레일링 스탑 활성화
📊 트레일링 스탑 활성화 | 수익률: 0.32%
🎯 목표 수익률 1.0% 도달! 트레일링 활성화 (손절가→매입가: 137,370,000원)

# 보유 중 상태
📈 보유 중 | 현재가: 138,000,000원 | 수익률: +0.46% | 손절가: 137,448,000원

# 매도 완료
🎉 매도 완료 | 사유: trailing_stop | 수익: +8,500원 (+0.85%)
```

## ⚠️ 주의사항

1. **테스트 모드**: 기본값으로 `DRY_RUN = True`가 설정되어 있어 실제 거래가 수행되지 않습니다.

2. **실제 거래 시**: `DRY_RUN = False`로 변경 후 반드시 소액으로 테스트하세요.

3. **API 제한**: 업비트 API 요청 제한:
   - 시세 조회: 초당 10회
   - 주문 생성/취소: 초당 8회

4. **수수료**: 거래 수수료 0.05%가 누적되므로 빈번한 거래 주의

5. **네트워크**: 안정적인 환경에서 실행 권장

## 📝 테스트

```bash
# 최소 금액으로 매수/매도 테스트
./venv/bin/python test_order.py
```

## 📁 파일 구조

```
upbit2/
├── momentum_trader.py   # 메인 트레이딩 봇
├── test_order.py        # 매수/매도 테스트 스크립트
├── run_trader.sh        # 실행 스크립트
├── .env                 # API 키 설정
├── api.md              # API 문서
└── README.md           # 이 파일
```

## 📝 라이선스

본 코드는 교육 및 연구 목적으로 제공됩니다.
실제 투자에 사용할 경우 발생하는 손실에 대해 책임지지 않습니다.
